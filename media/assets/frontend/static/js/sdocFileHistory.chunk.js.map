{"version":3,"sources":["components/rename.js","pages/sdoc-file-history/history-version.js","components/common/switch/index.js","pages/sdoc-file-history/side-panel.js","pages/sdoc-file-history/index.js","components/common/go-back/index.js"],"names":["Rename","props","onChange","e","setState","name","target","value","onClick","nativeEvent","stopImmediatePropagation","onKeyPress","key","onRenameConfirm","newName","state","trim","validateInput","isValid","errMessage","toaster","danger","onRenameCancel","indexOf","gettext","this","refs","renameInput","focus","hasSuffix","endIndex","lastIndexOf","setSelectionRange","className","ref","React","Component","moment","locale","window","app","config","lang","HistoryVersion","onMouseEnter","currentVersion","historyVersion","commit_id","isShowOperationIcon","onMouseLeave","onToggleClick","isMenuShow","onSelectHistoryVersion","onRestore","onItemDownload","onItemCopy","ctime_format","ctime","format","onCopy","toggleRename","isRenameShow","obj_id","renameHistoryVersion","creator_name","isHighlightItem","url","URLDecorator","getUrl","type","filePath","objID","Dropdown","isOpen","toggle","DropdownToggle","tag","alt","DropdownMenu","DropdownItem","href","onItemDownLoad","index","Switch","checked","placeholder","disabled","size","classnames","docUuid","fileHistory","pageOptions","SidePanel","loadMore","isReloadingData","currentPage","seafileAPI","listSdocHistory","PER_PAGE","then","res","updateResultState","data","renameSdocHistory","historyVersions","map","item","catch","error","errorMessage","Utils","getErrorMsg","isLoading","onScrollHandler","event","clientHeight","scrollHeight","scrollTop","hasMore","restoreVersion","currentItem","path","editUtilities","revertFile","success","refershFileList","message","isShowChanges","historyVersionIndex","findIndex","copyHistoryFile","sdocCopyHistoryFile","historyRepoID","filename","file_name","replace","renderHistoryVersions","length","onShowChanges","lastVersion","fileOwner","Error","initResultState","result","histories","page","total_count","creator_email","onScroll","serviceURL","avatarURL","siteRoot","username","repoID","fileName","assetsUrl","seafile","docPath","docName","isOpenSocket","serviceUrl","SdocFileHistory","getFileRevision","getFileContent","currentVersionContent","lastVersionContent","setContent","changes","currentDiffIndex","localStorage","setItem","setDiffCount","diff","jumpToElement","change","changeElement","document","querySelectorAll","historyContentRef","offsetTop","lastChange","nextChange","renderChangesTip","changesCount","id","UncontrolledTooltip","placement","getItem","currentContent","lastContent","didMountCallback","ReactDom","render","getElementById","GoBack","onBackClick","preventDefault","history","back"],"mappings":"+OAYMA,EAAM,kDAEV,WAAYC,GAAQ,IAAD,EAIf,OAJe,qBACjB,cAAMA,IAgBRC,SAAW,SAACC,GACV,EAAKC,SAAS,CAACC,KAAMF,EAAEG,OAAOC,OAChC,EAAC,EAEDC,QAAU,SAACL,GACTA,EAAEM,YAAYC,0BAChB,EAAC,EAEDC,WAAa,SAACR,GACE,UAAVA,EAAES,KACJ,EAAKC,gBAAgBV,EAEzB,EAAC,EAEDU,gBAAkB,SAACV,GACjBA,EAAEM,YAAYC,2BACd,IAAII,EAAU,EAAKC,MAAMV,KAAKW,OAC9B,GAAIF,IAAY,EAAKb,MAAMI,KAA3B,CAGC,MAE6B,EAAKY,gBAA7BC,EAAO,EAAPA,QAASC,EAAU,EAAVA,WACVD,EAGH,EAAKjB,MAAMY,gBAAgBC,GAF3BM,IAAQC,OAAOF,EAJjB,MAFE,EAAKlB,MAAMqB,gBAUf,EAAC,EAEDA,eAAiB,SAACnB,GAChBA,EAAEM,YAAYC,2BACd,EAAKT,MAAMqB,gBACb,EAAC,EAEDL,cAAgB,WACd,IAAIH,EAAU,EAAKC,MAAMV,KAAKW,OAC1BE,GAAU,EACVC,EAAa,GACjB,OAAKL,EAMDA,EAAQS,QAAQ,MAAQ,EAGnB,CAAEL,QAFTA,GAAU,EAEQC,WADlBA,EAAaK,aAAQ,iCAIhB,CAAEN,UAASC,cATT,CAAED,QAFTA,GAAU,EAEQC,WADlBA,EAAaK,aAAQ,qBAWzB,EAnEE,EAAKT,MAAQ,CACXV,KAAMJ,EAAMI,MACZ,CACJ,CAgFC,OAhFA,8CAED,WAEE,GADAoB,KAAKC,KAAKC,YAAYC,QAClBH,KAAKxB,MAAM4B,UAAW,CACxB,IAAIC,EAAWL,KAAKxB,MAAMI,KAAK0B,YAAY,KAC3CN,KAAKC,KAAKC,YAAYK,kBAAkB,EAAGF,EAAU,UACvD,MACEL,KAAKC,KAAKC,YAAYK,kBAAkB,GAAI,EAEhD,GAAC,oBAwDD,WACE,OACE,sBAAKC,UAAU,mBAAkB,UAC/B,uBACEC,IAAI,cACJ3B,MAAOkB,KAAKV,MAAMV,KAClBH,SAAUuB,KAAKvB,SACfS,WAAYc,KAAKd,WACjBH,QAASiB,KAAKjB,UAEhB,wBAAQyB,UAAU,6CAA6CzB,QAASiB,KAAKZ,kBAC7E,wBAAQoB,UAAU,2CAA2CzB,QAASiB,KAAKH,mBAGjF,KAAC,EAvFS,CAASa,IAAMC,WA4FZpC,K,oVC9FfqC,IAAOC,OAAOC,OAAOC,IAAIC,OAAOC,MAAM,IAyHvBC,EAvHK,kDAElB,WAAY1C,GAAQ,IAAD,EAMf,OANe,qBACjB,cAAMA,IAQR2C,aAAe,WAAO,IAAD,EACwB,EAAK3C,MAAxC4C,EAAc,EAAdA,eAAgBC,EAAc,EAAdA,eACpBD,EAAeE,YAAcD,EAAeC,WAChD,EAAK3C,SAAS,CAAE4C,qBAAqB,GACvC,EAAC,EAEDC,aAAe,WAAO,IAAD,EACwB,EAAKhD,MAAxC4C,EAAc,EAAdA,eAAgBC,EAAc,EAAdA,eACpBD,EAAeE,YAAcD,EAAeC,WAChD,EAAK3C,SAAS,CAAE4C,qBAAqB,GACvC,EAAC,EAEDE,cAAgB,SAAC/C,GACf,EAAKC,SAAS,CAAE+C,YAAa,EAAKpC,MAAMoC,YAC1C,EAAC,EAED3C,QAAU,WACR,EAAKJ,SAAS,CAAE4C,qBAAqB,IAAS,MACH,EAAK/C,MAAxC4C,EAAc,EAAdA,eAAgBC,EAAc,EAAdA,eACpBD,EAAeE,YAAcD,EAAeC,WAChD,EAAK9C,MAAMmD,uBAAuBN,EACpC,EAAC,EAEDO,UAAY,WAAO,IACTP,EAAmB,EAAK7C,MAAxB6C,eACR,EAAK7C,MAAMoD,UAAUP,EACvB,EAAC,EAEDQ,eAAiB,WACf,EACD,EAEDC,WAAa,WAAO,IACVT,EAAmB,EAAK7C,MAAxB6C,eACRA,EAAeU,aAAenB,IAAOS,EAAeW,OAAOC,OAAO,oBAClE,EAAKzD,MAAM0D,OAAOb,EACpB,EAAC,EAEDc,aAAe,WACb,EAAKxD,SAAS,CAACyD,cAAe,EAAK9C,MAAM8C,cAC3C,EAAC,EAEDhD,gBAAkB,SAACC,GAAa,IACtBgD,EAAW,EAAK7D,MAAM6C,eAAtBgB,OACR,EAAK7D,MAAM8D,qBAAqBD,EAAQhD,GACxC,EAAK8C,cACP,EAAC,EAEDtC,eAAiB,WACf,EAAKsC,cACP,EAzDE,EAAK7C,MAAQ,CACXiC,qBAAqB,EACrBG,YAAY,EACZU,cAAc,GACd,CACJ,CAiGC,OAjGA,mCAsDD,WAAU,IAAD,EACoCpC,KAAKxB,MAAxC4C,EAAc,EAAdA,eAAgBC,EAAc,EAAdA,eACxB,IAAKD,IAAmBC,EAAgB,OAAO,KAAK,IAC5CW,EAAgDX,EAAhDW,MAAOV,EAAyCD,EAAzCC,UAAWiB,EAA8BlB,EAA9BkB,aAAcF,EAAgBhB,EAAhBgB,OAAQzD,EAAQyC,EAARzC,KAC1C4D,EAAkBlB,IAAcF,EAAeE,UAC/CmB,EAAMC,IAAaC,OAAO,CAAEC,KAAM,yBAA0BC,SAAUA,KAAUC,MAAOT,IAC7F,OACE,qBACE7B,UAAS,4BAAuBgC,EAAkB,cAAgB,IAClErB,aAAcnB,KAAKmB,aACnBK,aAAcxB,KAAKwB,aACnBzC,QAASiB,KAAKjB,QAAQ,UAEtB,sBAAKyB,UAAU,eAAc,UAC1BR,KAAKV,MAAM8C,aACV,cAAC,IAAM,CAACxD,KAAMA,EAAMQ,gBAAiBY,KAAKZ,gBAAiBS,eAAgBG,KAAKH,iBAC/E,qBAAKW,UAAU,OAAM,SAAE5B,IAE1B,qBAAK4B,UAAU,OAAM,SAAEI,IAAOoB,GAAOC,OAAO,sBAC5C,sBAAKzB,UAAU,QAAO,UACpB,sBAAMA,UAAU,gBAChB,+BAAO+B,UAGX,qBAAK/B,UAAU,oBAAmB,SAChC,eAACuC,EAAA,EAAQ,CAACC,OAAQhD,KAAKV,MAAMoC,WAAYuB,OAAQjD,KAAKyB,cAAc,UAClE,cAACyB,EAAA,EAAc,CACbC,IAAI,IACJ3C,UAAS,4BAAwBR,KAAKV,MAAMiC,qBAAuBiB,EAAmB,GAAK,aAC3F,cAAY,WACZ,gBAAexC,KAAKV,MAAMoC,WAC1B0B,IAAKrD,aAAQ,qBAEf,eAACsD,EAAA,EAAY,WAEX,cAACC,EAAA,EAAY,CAACH,IAAI,IAAII,KAAMd,EAAK1D,QAASiB,KAAKwD,eAAe,SAAEzD,aAAQ,cACjD,IAArBC,KAAKxB,MAAMiF,OAAgB,cAACH,EAAA,EAAY,CAACvE,QAASiB,KAAK8B,WAAW,SAAE/B,aAAQ,UAC9E,cAACuD,EAAA,EAAY,CAACvE,QAASiB,KAAKmC,aAAa,SAAEpC,aAAQ,sBAM/D,KAAC,EA1GiB,CAASW,IAAMC,W,QCwBpB+C,MA9Bf,SAAgBlF,GAAQ,IACdC,EAA8DD,EAA9DC,SAAUkF,EAAoDnF,EAApDmF,QAASC,EAA2CpF,EAA3CoF,YAAaC,EAA8BrF,EAA9BqF,SAAUrD,EAAoBhC,EAApBgC,UAAWsD,EAAStF,EAATsF,KAE7D,OACE,qBAAKtD,UAAWuD,IAAW,kCAAmCvD,EAAWsD,GAAM,SAC7E,wBAAOtD,UAAU,gBAAe,UAC9B,uBACEA,UAAU,sBACVoC,KAAK,WACLe,QAASA,EACTlF,SAAUA,EACVG,KAAK,yBACLiF,SAAUA,IAEZ,sBAAMrD,UAAU,0CAAyC,SAAEoD,IAC3D,sBAAMpD,UAAU,gCAIxB,ECbQwD,EAAYlD,OAAOmD,YAAYC,YAA/BF,QAwOOG,EAtOA,kDAEb,WAAY3F,GAAQ,IAAD,EAUf,OAVe,qBACjB,cAAMA,IAsDR4F,SAAW,WACT,IAAK,EAAK9E,MAAM+E,gBAAiB,CAC/B,IAAIC,EAAc,EAAKhF,MAAMgF,YAAc,EAC3C,EAAK3F,SAAS,CACZ2F,YAAaA,EACbD,iBAAiB,IAEnBE,IAAWC,gBAAgBR,EAASM,EAAaG,KAAUC,MAAK,SAAAC,GAC9D,EAAKC,kBAAkBD,EAAIE,MAC3B,EAAKlG,SAAS,CAAC0F,iBAAiB,GAClC,GACF,CACF,EAAC,EAED/B,qBAAuB,SAACQ,EAAOzD,GAC7BkF,IAAWO,kBAAkBd,EAASlB,EAAOzD,GAASqF,MAAK,SAACC,GAC1D,EAAKhG,SAAS,CACZoG,gBAAiB,EAAKzF,MAAMyF,gBAAgBC,KAAI,SAAAC,GAI9C,OAHIA,EAAK5C,QAAUS,IACjBmC,EAAKrG,KAAOS,GAEP4F,CACT,KAEJ,IAAGC,OAAM,SAAAC,GACP,IAAMC,EAAeC,IAAMC,YAAYH,GAAO,GAC9C,EAAKxG,SAAS,CAAE4G,WAAW,EAAOH,aAAcA,GAClD,GACF,EAAC,EAEDI,gBAAkB,SAACC,GACjB,IAAMC,EAAeD,EAAM5G,OAAO6G,aAC5BC,EAAeF,EAAM5G,OAAO8G,aAEhBD,EADAD,EAAM5G,OAAO+G,UACc,GAAKD,GAClC,EAAKrG,MAAMuG,SACzB,EAAKzB,UAET,EAAC,EAED0B,eAAiB,SAACC,GAAiB,IACzBzE,EAAoByE,EAApBzE,UAAW0E,EAASD,EAATC,KACnBC,IAAcC,WAAWF,EAAM1E,GAAWoD,MAAK,SAAAC,GACzCA,EAAIE,KAAKsB,UACX,EAAKxH,SAAS,CAAC4G,WAAW,IAC1B,EAAKa,mBAEP,IAAIC,EAAUtG,aAAQ,0BACtBJ,IAAQwG,QAAQE,EAClB,IAAGnB,OAAM,SAAAC,GACP,IAAMC,EAAeC,IAAMC,YAAYH,GAAO,GAC9CxF,IAAQC,OAAOG,aAAQqF,GACzB,GACF,EAAC,EAEDzD,uBAAyB,SAACN,GAExB,GAD0B,EAAK7C,MAAvB8H,cACR,CAGC,IACOvB,EAAoB,EAAKzF,MAAzByF,gBACFwB,EAAsBxB,EAAgByB,WAAU,SAAAvB,GAAI,OAAIA,EAAK3D,YAAcD,EAAeC,SAAS,IACzG,EAAK9C,MAAMmD,uBAAuBN,EAAgB0D,EAAgBwB,EAAsB,GAHxF,MAFE,EAAK/H,MAAMmD,uBAAuBN,EAMtC,EAAC,EAEDoF,gBAAkB,SAACpF,GAAoB,IAC7B2E,EAA+B3E,EAA/B2E,KAAM3D,EAAyBhB,EAAzBgB,OAAQN,EAAiBV,EAAjBU,aACtBwC,IAAWmC,oBAAoBC,KAAeX,EAAM3D,EAAQN,GAAc2C,MAAK,SAAAC,GAC7E,IAAI0B,EAAUtG,aAAQ,iCAClB6G,EAAWjC,EAAIE,KAAKgC,UACxBR,EAAUA,EAAQS,QAAQ,WAAYF,GACtCjH,IAAQwG,QAAQE,EAClB,IAAGnB,OAAM,SAAAC,GACP,IAAMC,EAAeC,IAAMC,YAAYH,GAAO,GAC9CxF,IAAQC,OAAOG,aAAQqF,GACzB,GACF,EAAC,EAED2B,sBAAwB,WAAO,IAAD,EACyB,EAAKzH,MAAlDiG,EAAS,EAATA,UAAWR,EAAe,EAAfA,gBAAiBK,EAAY,EAAZA,aACpC,OAA+B,IAA3BL,EAAgBiC,OACdzB,EAEA,qBAAK/E,UAAU,+DAA8D,SAC3E,cAAC,IAAO,MAIV4E,EAEA,qBAAK5E,UAAU,6EAA4E,SACxFT,aAAQqF,KAKb,qBAAK5E,UAAU,+EAA8E,SAC1FT,aAAQ,4BAMb,qCACGgF,EAAgBC,KAAI,SAAC3D,EAAgBoC,GACpC,OACE,cAAC,EAAc,CAEbA,MAAOA,EACPrC,eAAgB,EAAK5C,MAAM4C,eAC3BC,eAAgBA,EAChBM,uBAAwB,EAAKA,uBAC7BC,UAAW,EAAKkE,eAChB5D,OAAQ,EAAKuE,gBACbnE,qBAAsB,EAAKA,sBAPtBjB,EAAeC,UAU1B,IACCiE,GACC,qBAAK/E,UAAU,sEAAqE,SAClF,cAAC,IAAO,QAKlB,EAAC,EAEDyG,cAAgB,WAAO,IAAD,EACsB,EAAKzI,MAAvC8H,EAAa,EAAbA,cAAelF,EAAc,EAAdA,eACf2D,EAAoB,EAAKzF,MAAzByF,gBACFwB,EAAsBxB,EAAgByB,WAAU,SAAAvB,GAAI,OAAIA,EAAK3D,YAAcF,EAAeE,SAAS,IACnG4F,EAAcnC,EAAgBwB,EAAsB,GAC1D,EAAK/H,MAAMyI,eAAeX,EAAeY,EAC3C,EA3LE,EAAK5H,MAAQ,CACXiG,WAAW,EACXR,gBAAiB,GACjBK,aAAc,GACdd,YAAa,EACbuB,SAAS,EACTsB,UAAW,GACX9C,iBAAiB,GACjB,CACJ,CA+MC,OA/MA,8CAED,WAAqB,IAAD,OAClBE,IAAWC,gBAAgBR,EAAS,EAAGS,KAAUC,MAAK,SAAAC,GAEpD,GAA2B,IADTA,EAAIE,KACNmC,OAEd,MADA,EAAKrI,SAAS,CAAC4G,WAAW,IACpB6B,MAAM,gCAEd,EAAKC,gBAAgB1C,EAAIE,KAC3B,GACF,GAAC,6BAED,WAAmB,IAAD,OAChBN,IAAWC,gBAAgBR,EAAS,EAAGS,KAAUC,MAAK,SAAAC,GACpD,EAAK0C,gBAAgB1C,EAAIE,KAC3B,GACF,GAAC,6BAED,SAAgByC,GACVA,EAAOC,UAAUP,SACnBhH,KAAKrB,SAAS,CACZoG,gBAAiBuC,EAAOC,UACxBjD,YAAagD,EAAOE,KACpB3B,QAASyB,EAAOG,YAAehD,IAAWzE,KAAKV,MAAMgF,YACrDiB,WAAW,EACX4B,UAAWG,EAAOC,UAAU,GAAGG,gBAEjC1H,KAAKxB,MAAMmD,uBAAuB2F,EAAOC,UAAU,GAAID,EAAOC,UAAU,IAE5E,GAAC,+BAED,SAAkBD,GACZA,EAAOC,UAAUP,QACnBhH,KAAKrB,SAAS,CACZoG,gBAAgB,GAAD,mBAAM/E,KAAKV,MAAMyF,iBAAe,YAAKuC,EAAOC,YAC3DjD,YAAagD,EAAOE,KACpB3B,QAASyB,EAAOG,YAAehD,IAAWzE,KAAKV,MAAMgF,YACrDiB,WAAW,EACX4B,UAAWG,EAAOC,UAAU,GAAGG,eAGrC,GAAC,oBA0ID,WAAU,IACA3C,EAAoB/E,KAAKV,MAAzByF,gBAER,OACE,sBAAKvE,UAAU,4DAA2D,UACxE,qBAAKA,UAAU,iCAAgC,SAC7C,qBAAKA,UAAU,uCAAsC,SAClDT,aAAQ,wBAGb,qBACES,UAAWuD,IAAW,6BAA8B,CAAE,WAAuC,IAA3BgB,EAAgBiC,SAClFW,SAAU3H,KAAKwF,gBAAgB,SAE9BxF,KAAK+G,0BAER,qBAAKvG,UAAU,0DAAyD,SACtE,cAAC,EAAM,CACLmD,QAAS3D,KAAKxB,MAAM8H,cACpB1C,YAAa7D,aAAQ,gBACrBS,UAAU,kCACVsD,KAAK,QACLrF,SAAUuB,KAAKiH,oBAKzB,KAAC,EA5NY,CAAStG,aCAiB,G,eAEGG,OAAOC,IAAIC,QAA/C4G,EAAU,EAAVA,WAAYC,EAAS,EAATA,UAAWC,EAAQ,EAARA,SAAQ,EACZhH,OAAOC,IAAImD,YAA9B6D,EAAQ,EAARA,SAAUnJ,EAAI,EAAJA,KAAI,EACsCkC,OAAOmD,YAAYC,YAAvE8D,EAAM,EAANA,OAAQC,EAAQ,EAARA,SAAUpF,EAAQ,EAARA,SAAUmB,EAAO,EAAPA,QAASkE,EAAS,EAATA,UAE7CpH,OAAOqH,QAAU,CACfH,SACAI,QAASvF,EACTwF,QAASJ,EACTjE,UACAsE,cAAc,EACdC,WAAYX,EACZhJ,OACAmJ,WACAF,YACAC,WACAI,aACA,IAEIM,EAAe,kDAEnB,WAAYhK,GAAQ,IAAD,uBACjB,cAAMA,IAaRmD,uBAAyB,SAACP,EAAgB8F,GACxC,EAAKvI,SAAS,CAAE4G,WAAW,EAAMnE,mBACjCmD,IAAWkE,gBAAgB9B,KAAevF,EAAeE,UAAWF,EAAe4E,MAAMtB,MAAK,SAAAC,GAC5F,OAAOJ,IAAWmE,eAAe/D,EAAIE,KACvC,IAAGH,MAAK,SAAAC,GACN,IAAMgE,EAAwBhE,EAAIE,KAC9BqC,EACF3C,IAAWkE,gBAAgB9B,KAAeO,EAAY5F,UAAW4F,EAAYlB,MAAMtB,MAAK,SAAAC,GACtF,OAAOJ,IAAWmE,eAAe/D,EAAIE,KACvC,IAAGH,MAAK,SAAAC,GACN,IAAMiE,EAAqBjE,EAAIE,KAC/B,EAAKgE,WAAWF,EAAuBC,EACzC,IAAG1D,OAAM,SAAAC,GACP,IAAMC,EAAeC,IAAMC,YAAYH,GAAO,GAC9CxF,IAAQC,OAAOG,aAAQqF,IACvB,EAAKyD,WAAWF,EAAuB,GACzC,IAEA,EAAKE,WAAWF,EAAuB,GAE3C,IAAGzD,OAAM,SAAAC,GACP,IAAMC,EAAeC,IAAMC,YAAYH,GAAO,GAC9CxF,IAAQC,OAAOG,aAAQqF,IACvB,EAAKyD,WAAW,GAAI,GACtB,GACF,EAAC,EAEDA,WAAa,WAA0D,IAAzDF,EAAqB,uDAAG,GAAIC,EAAkB,uDAAG,GAC7D,EAAKjK,SAAS,CAAEgK,wBAAuBC,qBAAoBrD,WAAW,EAAOuD,QAAS,GAAIC,iBAAkB,GAC9G,EAAC,EAED9B,cAAgB,SAACX,EAAeY,GAC9B,GAAIZ,GAAiBY,EAArB,CAAmC,IACzByB,EAA0B,EAAKrJ,MAA/BqJ,sBACR,EAAKhK,SAAS,CAAE4G,WAAW,IAAQ,WACjCyD,aAAaC,QAAQ,mCAAoC3C,EAAgB,IACzE/B,IAAWkE,gBAAgB9B,KAAeO,EAAY5F,UAAW4F,EAAYlB,MAAMtB,MAAK,SAAAC,GACtF,OAAOJ,IAAWmE,eAAe/D,EAAIE,KACvC,IAAGH,MAAK,SAAAC,GACN,IAAMiE,EAAqBjE,EAAIE,KAC/B,EAAKgE,WAAWF,EAAuBC,GACvC,EAAKjK,SAAS,CAAE2H,iBAClB,IAAGpB,OAAM,SAAAC,GACP,IAAMC,EAAeC,IAAMC,YAAYH,GAAO,GAC9CxF,IAAQC,OAAOG,aAAQqF,IACvB,EAAKyD,WAAWF,EAAuB,IACvC,EAAKhK,SAAS,CAAE2H,iBAClB,GACF,GAEF,MACA,EAAK3H,SAAS,CAAE2H,kBAAiB,WAC/B0C,aAAaC,QAAQ,mCAAoC3C,EAAgB,GAC3E,GACF,EAAC,EAED4C,aAAe,WAAwC,IAAvCC,EAAI,uDAAG,CAAErK,MAAO,GAAIgK,QAAS,IACnCA,EAAYK,EAAZL,QACR,EAAKnK,SAAS,CAAEmK,UAASC,iBAAkB,GAC7C,EAAC,EAEDK,cAAgB,SAACL,GACf,EAAKpK,SAAS,CAAEoK,qBAAoB,WAAO,IAAD,EACF,EAAKzJ,MAAnCyJ,EAAgB,EAAhBA,iBACFM,EAD2B,EAAPP,QACHC,GACjBO,EAAgBC,SAASC,iBAAiB,YAAD,OAAaH,EAAM,MAAK,GACnEC,IACF,EAAKG,kBAAkB7D,UAAY0D,EAAcI,UAAY,GAEjE,GACF,EAAC,EAEDC,WAAa,WAAO,IAAD,EACqB,EAAKrK,MAAnCyJ,EAAgB,EAAhBA,iBAAkBD,EAAO,EAAPA,QACD,IAArBC,EAIJ,EAAKK,cAAcL,EAAmB,GAHpC,EAAKK,cAAcN,EAAQ9B,OAAS,EAIxC,EAAC,EAED4C,WAAa,WAAO,IAAD,EACqB,EAAKtK,MAAnCyJ,EAAgB,EAAhBA,iBACJA,IAD6B,EAAPD,QACO9B,OAAS,EAI1C,EAAKoC,cAAcL,EAAmB,GAHpC,EAAKK,cAAc,EAIvB,EAAC,EAEDS,iBAAmB,WAAO,IAAD,EACyC,EAAKvK,MAA7DgH,EAAa,EAAbA,cAAewC,EAAO,EAAPA,QAASC,EAAgB,EAAhBA,iBAChC,GAD2D,EAATxD,UACnC,OAAO,KACtB,IAAKe,EAAe,OAAO,KAC3B,IAAMwD,EAAehB,EAAUA,EAAQ9B,OAAS,EAChD,OAAqB,IAAjB8C,EAEA,qBAAKtJ,UAAU,2DAA0D,SACvE,qBAAKA,UAAU,kEAAiE,SAC7ET,aAAQ,kBAOf,qBAAKS,UAAU,2DAA0D,SACvE,sBAAKA,UAAU,wDAAuD,UACpE,qBAAKA,UAAU,mFAAkF,mBAC3FT,aAAQ,WAAU,YAAIgJ,EAAmB,EAAC,YAAIe,KAEpD,qBAAKtJ,UAAU,8BACf,qBACEA,UAAU,0EACVuJ,GAAG,yBACHhL,QAAS,EAAK4K,WAAW,SAEzB,sBAAMnJ,UAAU,wBAElB,qBAAKA,UAAU,8BACf,qBACEA,UAAU,0EACVuJ,GAAG,yBACHhL,QAAS,EAAK6K,WAAW,SAEzB,sBAAMpJ,UAAU,0BAElB,cAACwJ,EAAA,EAAmB,CAACC,UAAU,SAASpL,OAAO,yBAAwB,SACpEkB,aAAQ,uBAEX,cAACiK,EAAA,EAAmB,CAACC,UAAU,SAASpL,OAAO,yBAAwB,SACpEkB,aAAQ,2BAKnB,EApJE,IAAMuG,EAA6E,UAA7D0C,aAAakB,QAAQ,oCASzC,OARF,EAAK5K,MAAQ,CACXiG,WAAW,EACXe,gBACAlF,eAAgB,CAAC,EACjBuH,sBAAuB,GACvBC,mBAAoB,GACpBE,QAAS,GACTC,iBAAkB,GAClB,CACJ,CA+KC,OA/KA,mCA4ID,WAAU,IAAD,SACyF/I,KAAKV,MAA7F8B,EAAc,EAAdA,eAAgBkF,EAAa,EAAbA,cAAeqC,EAAqB,EAArBA,sBAAuBC,EAAkB,EAAlBA,mBAAoBrD,EAAS,EAATA,UAElF,OACE,sBAAK/E,UAAU,gDAA+C,UAC5D,sBAAKA,UAAU,iDAAgD,UAC7D,sBAAKA,UAAU,6FAA4F,UACzG,sBAAKA,UAAWuD,IAAW,mEAAoE,CAAE,OAAQuC,IAAiB,UACxH,cAAC,IAAM,IACP,qBAAK9F,UAAU,0BAAyB,SAAEyH,OAE3CjI,KAAK6J,sBAER,qBAAKrJ,UAAU,+CAA+CC,IAAK,SAAAA,GAAG,OAAI,EAAKgJ,kBAAoBhJ,CAAG,EAAC,SACpG8E,EACC,qBAAK/E,UAAU,4EAA2E,SACxF,cAAC,IAAO,MAGV,cAAC,IAAU,CACT2J,eAAgBxB,EAChByB,YAAa9D,EAAgBsC,EAAqB,GAClDyB,iBAAkBrK,KAAKkJ,oBAK/B,cAAC,EAAS,CACR5C,cAAeA,EACflF,eAAgBA,EAChBO,uBAAwB3B,KAAK2B,uBAC7BsF,cAAejH,KAAKiH,kBAI5B,KAAC,EA7LkB,CAASvG,IAAMC,WAgMpC2J,IAASC,OAAO,cAAC,EAAe,IAAKhB,SAASiB,eAAe,W,0FC9NvDC,EAAM,iKAKT,OALS,oCAEVC,YAAc,SAACjF,GACbA,EAAMkF,iBACN7J,OAAO8J,QAAQC,MACjB,EAAC,EAQA,OARA,mCAED,WACE,OACE,qBAAKrK,UAAU,UAAUzB,QAASiB,KAAK0K,YAAY,SACjD,sBAAMlK,UAAU,yBAGtB,KAAC,EAbS,CAASG,aAgBN8J,K","file":"static/js/sdocFileHistory.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext } from '../utils/constants';\nimport toaster from './toast';\n\nconst propTypes = {\n  hasSuffix: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onRenameConfirm: PropTypes.func.isRequired,\n  onRenameCancel: PropTypes.func.isRequired,\n};\n\nclass Rename extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      name: props.name\n    };\n  }\n\n  componentDidMount() {\n    this.refs.renameInput.focus();\n    if (this.props.hasSuffix) {\n      var endIndex = this.props.name.lastIndexOf('.');\n      this.refs.renameInput.setSelectionRange(0, endIndex, 'forward');\n    } else {\n      this.refs.renameInput.setSelectionRange(0, -1);\n    }\n  }\n\n  onChange = (e) => {\n    this.setState({name: e.target.value});\n  }\n\n  onClick = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n  }\n\n  onKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      this.onRenameConfirm(e);\n    }\n  }\n\n  onRenameConfirm = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    let newName = this.state.name.trim();\n    if (newName === this.props.name) {\n      this.props.onRenameCancel();\n      return;\n    }\n\n    let { isValid, errMessage } = this.validateInput();\n    if (!isValid) {\n      toaster.danger(errMessage);\n    } else {\n      this.props.onRenameConfirm(newName);\n    }\n  }\n\n  onRenameCancel = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    this.props.onRenameCancel();\n  }\n\n  validateInput = () => {\n    let newName = this.state.name.trim();\n    let isValid = true;\n    let errMessage = '';\n    if (!newName) {\n      isValid = false;\n      errMessage = gettext('Name is required.');\n      return { isValid, errMessage };\n    }\n\n    if (newName.indexOf('/') > -1) {\n      isValid = false;\n      errMessage = gettext('Name should not include ' + '\\'/\\'' + '.');\n      return { isValid, errMessage };\n    }\n\n    return { isValid, errMessage };\n  }\n\n  render() {\n    return (\n      <div className=\"rename-container\">\n        <input\n          ref=\"renameInput\"\n          value={this.state.name}\n          onChange={this.onChange}\n          onKeyPress={this.onKeyPress}\n          onClick={this.onClick}\n        />\n        <button className=\"btn btn-secondary sf2-icon-confirm confirm\" onClick={this.onRenameConfirm}></button>\n        <button className=\"btn btn-secondary sf2-icon-cancel cancel\" onClick={this.onRenameCancel}></button>\n      </div>\n    );\n  }\n}\n\nRename.propTypes = propTypes;\n\nexport default Rename;\n","import moment from 'moment';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport { gettext, filePath } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\nimport Rename from '../../components/rename';\n\nimport '../../css/history-record-item.css';\n\nmoment.locale(window.app.config.lang);\n\nclass HistoryVersion extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowOperationIcon: false,\n      isMenuShow: false,\n      isRenameShow: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commit_id === historyVersion.commit_id) return;\n    this.setState({ isShowOperationIcon: true });\n  }\n\n  onMouseLeave = () => {\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commit_id === historyVersion.commit_id) return;\n    this.setState({ isShowOperationIcon: false });\n  }\n\n  onToggleClick = (e) => {\n    this.setState({ isMenuShow: !this.state.isMenuShow });\n  }\n\n  onClick = () => {\n    this.setState({ isShowOperationIcon: false });\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commit_id === historyVersion.commit_id) return;\n    this.props.onSelectHistoryVersion(historyVersion);\n  }\n\n  onRestore = () => {\n    const { historyVersion } = this.props;\n    this.props.onRestore(historyVersion);\n  }\n\n  onItemDownload = () => {\n    // nothing todo\n  }\n\n  onItemCopy = () => {\n    const { historyVersion } = this.props;\n    historyVersion.ctime_format = moment(historyVersion.ctime).format('YYYY-MM-DD HH:mm');\n    this.props.onCopy(historyVersion);\n  }\n\n  toggleRename = () => {\n    this.setState({isRenameShow: !this.state.isRenameShow});\n  }\n\n  onRenameConfirm = (newName) => {\n    const { obj_id } = this.props.historyVersion;\n    this.props.renameHistoryVersion(obj_id, newName);\n    this.toggleRename();\n  }\n\n  onRenameCancel = () => {\n    this.toggleRename();\n  }\n\n  render() {\n    const { currentVersion, historyVersion } = this.props;\n    if (!currentVersion || !historyVersion) return null;\n    const { ctime, commit_id, creator_name, obj_id, name} = historyVersion;\n    const isHighlightItem = commit_id === currentVersion.commit_id;\n    const url = URLDecorator.getUrl({ type: 'download_historic_file', filePath: filePath, objID: obj_id });\n    return (\n      <li\n        className={`history-list-item ${isHighlightItem ? 'item-active' : ''}`}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        onClick={this.onClick}\n      >\n        <div className=\"history-info\">\n          {this.state.isRenameShow ?\n            <Rename name={name} onRenameConfirm={this.onRenameConfirm} onRenameCancel={this.onRenameCancel}/>\n            :<div className=\"name\">{name}</div>\n          }\n          <div className=\"time\">{moment(ctime).format('YYYY-MM-DD HH:mm')}</div>\n          <div className=\"owner\">\n            <span className=\"squire-icon\"></span>\n            <span>{creator_name}</span>\n          </div>\n        </div>\n        <div className=\"history-operation\">\n          <Dropdown isOpen={this.state.isMenuShow} toggle={this.onToggleClick}>\n            <DropdownToggle\n              tag='a'\n              className={`fas fa-ellipsis-v ${(this.state.isShowOperationIcon || isHighlightItem) ? '' : 'invisible'}`}\n              data-toggle=\"dropdown\"\n              aria-expanded={this.state.isMenuShow}\n              alt={gettext('More Operations')}\n            />\n            <DropdownMenu>\n              {/* {(this.props.index !== 0) && <DropdownItem onClick={this.onItemRestore}>{gettext('Restore')}</DropdownItem>} */}\n              <DropdownItem tag='a' href={url} onClick={this.onItemDownLoad}>{gettext('Download')}</DropdownItem>\n              {(this.props.index !== 0) && <DropdownItem onClick={this.onItemCopy}>{gettext('Copy')}</DropdownItem>}\n              <DropdownItem onClick={this.toggleRename}>{gettext('Rename')}</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </div>\n      </li>\n    );\n  }\n}\n\nHistoryVersion.propTypes = {\n  index: PropTypes.number,\n  currentVersion: PropTypes.object.isRequired,\n  historyVersion: PropTypes.object,\n  onSelectHistoryVersion: PropTypes.func.isRequired,\n  onRestore: PropTypes.func.isRequired,\n  onCopy: PropTypes.func.isRequired,\n  renameHistoryVersion: PropTypes.func.isRequired,\n};\n\nexport default HistoryVersion;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\n\nimport '../../../css/switch.css';\n\nfunction Switch(props) {\n  const { onChange, checked, placeholder, disabled, className, size } = props;\n\n  return(\n    <div className={classnames('seahub-switch position-relative', className, size)}>\n      <label className=\"custom-switch\">\n        <input\n          className=\"custom-switch-input\"\n          type=\"checkbox\"\n          checked={checked}\n          onChange={onChange}\n          name=\"custom-switch-checkbox\"\n          disabled={disabled}\n        />\n        <span className=\"custom-switch-description text-truncate\">{placeholder}</span>\n        <span className=\"custom-switch-indicator\"></span>\n      </label>\n    </div>\n  );\n}\n\nSwitch.propTypes = {\n  checked: PropTypes.bool,\n  disabled: PropTypes.bool,\n  placeholder: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n  className: PropTypes.string,\n  size: PropTypes.oneOf(['large', 'small', undefined]),\n  onChange: PropTypes.func.isRequired,\n};\n\nexport default Switch;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport Loading from '../../components/loading';\nimport { gettext, historyRepoID, PER_PAGE } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport editUtilities from '../../utils/editor-utilities';\nimport toaster from '../../components/toast';\nimport HistoryVersion from './history-version';\nimport Switch from '../../components/common/switch';\n\nconst { docUuid } = window.fileHistory.pageOptions;\n\nclass SidePanel extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      historyVersions: [],\n      errorMessage: '',\n      currentPage: 1,\n      hasMore: false,\n      fileOwner: '',\n      isReloadingData: false,\n    };\n  }\n\n  componentDidMount() {\n    seafileAPI.listSdocHistory(docUuid, 1, PER_PAGE).then(res => {\n      let historyList = res.data;\n      if (historyList.length === 0) {\n        this.setState({isLoading: false});\n        throw Error('there has an error in server');\n      }\n      this.initResultState(res.data);\n    });\n  }\n\n  refershFileList() {\n    seafileAPI.listSdocHistory(docUuid, 1, PER_PAGE).then(res => {\n      this.initResultState(res.data);\n    });\n  }\n\n  initResultState(result) {\n    if (result.histories.length) {\n      this.setState({\n        historyVersions: result.histories,\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        fileOwner: result.histories[0].creator_email,\n      });\n      this.props.onSelectHistoryVersion(result.histories[0], result.histories[1]);\n    }\n  }\n\n  updateResultState(result) {\n    if (result.histories.length) {\n      this.setState({\n        historyVersions: [...this.state.historyVersions, ...result.histories],\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        fileOwner: result.histories[0].creator_email\n      });\n    }\n  }\n\n  loadMore = () => {\n    if (!this.state.isReloadingData) {\n      let currentPage = this.state.currentPage + 1;\n      this.setState({\n        currentPage: currentPage,\n        isReloadingData: true,\n      });\n      seafileAPI.listSdocHistory(docUuid, currentPage, PER_PAGE).then(res => {\n        this.updateResultState(res.data);\n        this.setState({isReloadingData: false});\n      });\n    }\n  }\n\n  renameHistoryVersion = (objID, newName) => {\n    seafileAPI.renameSdocHistory(docUuid, objID, newName).then((res) => {\n      this.setState({\n        historyVersions: this.state.historyVersions.map(item => {\n          if (item.obj_id == objID) {\n            item.name = newName;\n          }\n          return item;\n        })\n      });\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      this.setState({ isLoading: false, errorMessage: errorMessage });\n    });\n  }\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    if (isBottom && this.state.hasMore) {\n      this.loadMore();\n    }\n  }\n\n  restoreVersion = (currentItem) => {\n    const { commit_id, path } = currentItem;\n    editUtilities.revertFile(path, commit_id).then(res => {\n      if (res.data.success) {\n        this.setState({isLoading: true});\n        this.refershFileList();\n      }\n      let message = gettext('Successfully restored.');\n      toaster.success(message);\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n    });\n  }\n\n  onSelectHistoryVersion = (historyVersion) => {\n    const { isShowChanges } = this.props;\n    if (!isShowChanges) {\n      this.props.onSelectHistoryVersion(historyVersion);\n      return;\n    }\n    const { historyVersions } = this.state;\n    const historyVersionIndex = historyVersions.findIndex(item => item.commit_id === historyVersion.commit_id);\n    this.props.onSelectHistoryVersion(historyVersion, historyVersions[historyVersionIndex + 1]);\n  }\n\n  copyHistoryFile = (historyVersion) => {\n    const { path, obj_id, ctime_format } = historyVersion;\n    seafileAPI.sdocCopyHistoryFile(historyRepoID, path, obj_id, ctime_format).then(res => {\n      let message = gettext('Successfully copied %(name)s.');\n      let filename = res.data.file_name;\n      message = message.replace('%(name)s', filename);\n      toaster.success(message);\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n    });\n  }\n\n  renderHistoryVersions = () => {\n    const { isLoading, historyVersions, errorMessage } = this.state;\n    if (historyVersions.length === 0) {\n      if (isLoading) {\n        return (\n          <div className=\"h-100 w-100 d-flex align-items-center justify-content-center\">\n            <Loading />\n          </div>\n        );\n      }\n      if (errorMessage) {\n        return (\n          <div className=\"h-100 w-100 d-flex align-items-center justify-content-center error-message\">\n            {gettext(errorMessage)}\n          </div>\n        );\n      }\n      return (\n        <div className=\"h-100 w-100 d-flex align-items-center justify-content-center empty-tip-color\">\n          {gettext('No_historical_versions')}\n        </div>\n      );\n    }\n\n    return (\n      <>\n        {historyVersions.map((historyVersion, index) => {\n          return (\n            <HistoryVersion\n              key={historyVersion.commit_id}\n              index={index}\n              currentVersion={this.props.currentVersion}\n              historyVersion={historyVersion}\n              onSelectHistoryVersion={this.onSelectHistoryVersion}\n              onRestore={this.restoreVersion}\n              onCopy={this.copyHistoryFile}\n              renameHistoryVersion={this.renameHistoryVersion}\n            />\n          );\n        })}\n        {isLoading && (\n          <div className=\"loading-more d-flex align-items-center justify-content-center w-100\">\n            <Loading />\n          </div>\n        )}\n      </>\n    );\n  }\n\n  onShowChanges = () => {\n    const { isShowChanges, currentVersion } = this.props;\n    const { historyVersions } = this.state;\n    const historyVersionIndex = historyVersions.findIndex(item => item.commit_id === currentVersion.commit_id);\n    const lastVersion = historyVersions[historyVersionIndex + 1];\n    this.props.onShowChanges(!isShowChanges, lastVersion);\n  }\n\n  render() {\n    const { historyVersions } = this.state;\n\n    return (\n      <div className=\"sdoc-file-history-panel h-100 o-hidden d-flex flex-column\">\n        <div className=\"sdoc-file-history-select-range\">\n          <div className=\"sdoc-file-history-select-range-title\">\n            {gettext('History Versions')}\n          </div>\n        </div>\n        <div\n          className={classnames('sdoc-file-history-versions', { 'o-hidden': historyVersions.length === 0 } )}\n          onScroll={this.onScrollHandler}\n        >\n          {this.renderHistoryVersions()}\n        </div>\n        <div className=\"sdoc-file-history-diff-switch d-flex align-items-center\">\n          <Switch\n            checked={this.props.isShowChanges}\n            placeholder={gettext('Show changes')}\n            className=\"sdoc-history-show-changes w-100\"\n            size=\"small\"\n            onChange={this.onShowChanges}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = {\n  isShowChanges: PropTypes.bool,\n  currentVersion: PropTypes.object,\n  onSelectHistoryVersion: PropTypes.func,\n  onShowChanges: PropTypes.func,\n};\n\nexport default SidePanel;\n","import React from 'react';\nimport ReactDom from 'react-dom';\nimport { UncontrolledTooltip } from 'reactstrap';\nimport classnames from 'classnames';\nimport { DiffViewer } from '@seafile/sdoc-editor';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext, historyRepoID } from '../../utils/constants';\nimport Loading from '../../components/loading';\nimport GoBack from '../../components/common/go-back';\nimport SidePanel from './side-panel';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../../components/toast';\n\nimport '../../css/layout.css';\nimport '../../css/sdoc-file-history.css';\n\nconst { serviceURL, avatarURL, siteRoot } = window.app.config;\nconst { username, name } = window.app.pageOptions;\nconst { repoID, fileName, filePath, docUuid, assetsUrl  } = window.fileHistory.pageOptions;\n\nwindow.seafile = {\n  repoID,\n  docPath: filePath,\n  docName: fileName,\n  docUuid,\n  isOpenSocket: false,\n  serviceUrl: serviceURL,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  assetsUrl,\n};\n\nclass SdocFileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    const isShowChanges = localStorage.getItem('seahub-sdoc-history-show-changes') === 'false' ? false : true;\n    this.state = {\n      isLoading: true,\n      isShowChanges,\n      currentVersion: {},\n      currentVersionContent: '',\n      lastVersionContent: '',\n      changes: [],\n      currentDiffIndex: 0,\n    };\n  }\n\n  onSelectHistoryVersion = (currentVersion, lastVersion) => {\n    this.setState({ isLoading: true, currentVersion });\n    seafileAPI.getFileRevision(historyRepoID, currentVersion.commit_id, currentVersion.path).then(res => {\n      return seafileAPI.getFileContent(res.data);\n    }).then(res => {\n      const currentVersionContent = res.data;\n      if (lastVersion) {\n        seafileAPI.getFileRevision(historyRepoID, lastVersion.commit_id, lastVersion.path).then(res => {\n          return seafileAPI.getFileContent(res.data);\n        }).then(res => {\n          const lastVersionContent = res.data;\n          this.setContent(currentVersionContent, lastVersionContent);\n        }).catch(error => {\n          const errorMessage = Utils.getErrorMsg(error, true);\n          toaster.danger(gettext(errorMessage));\n          this.setContent(currentVersionContent, '');\n        });\n      } else {\n        this.setContent(currentVersionContent, '');\n      }\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n      this.setContent('', '');\n    });\n  }\n\n  setContent = (currentVersionContent = '', lastVersionContent = '') => {\n    this.setState({ currentVersionContent, lastVersionContent, isLoading: false, changes: [], currentDiffIndex: 0 });\n  }\n\n  onShowChanges = (isShowChanges, lastVersion) => {\n    if (isShowChanges && lastVersion) {\n      const { currentVersionContent } = this.state;\n      this.setState({ isLoading: true }, () => {\n        localStorage.setItem('seahub-sdoc-history-show-changes', isShowChanges + '');\n        seafileAPI.getFileRevision(historyRepoID, lastVersion.commit_id, lastVersion.path).then(res => {\n          return seafileAPI.getFileContent(res.data);\n        }).then(res => {\n          const lastVersionContent = res.data;\n          this.setContent(currentVersionContent, lastVersionContent);\n          this.setState({ isShowChanges });\n        }).catch(error => {\n          const errorMessage = Utils.getErrorMsg(error, true);\n          toaster.danger(gettext(errorMessage));\n          this.setContent(currentVersionContent, '');\n          this.setState({ isShowChanges });\n        });\n      });\n      return;\n    }\n    this.setState({ isShowChanges }, () => {\n      localStorage.setItem('seahub-sdoc-history-show-changes', isShowChanges + '');\n    });\n  }\n\n  setDiffCount = (diff = { value: [], changes: [] }) => {\n    const { changes } = diff;\n    this.setState({ changes, currentDiffIndex: 0 });\n  }\n\n  jumpToElement = (currentDiffIndex) => {\n    this.setState({ currentDiffIndex }, () => {\n      const { currentDiffIndex, changes } = this.state;\n      const change = changes[currentDiffIndex];\n      const changeElement = document.querySelectorAll(`[data-id=${change}]`)[0];\n      if (changeElement) {\n        this.historyContentRef.scrollTop = changeElement.offsetTop - 10;\n      }\n    });\n  }\n\n  lastChange = () => {\n    const { currentDiffIndex, changes } = this.state;\n    if (currentDiffIndex === 0) {\n      this.jumpToElement(changes.length - 1);\n      return;\n    }\n    this.jumpToElement(currentDiffIndex - 1);\n  }\n\n  nextChange = () => {\n    const { currentDiffIndex, changes } = this.state;\n    if (currentDiffIndex === changes.length - 1) {\n      this.jumpToElement(0);\n      return;\n    }\n    this.jumpToElement(currentDiffIndex + 1);\n  }\n\n  renderChangesTip = () => {\n    const { isShowChanges, changes, currentDiffIndex, isLoading } = this.state;\n    if (isLoading) return null;\n    if (!isShowChanges) return null;\n    const changesCount = changes ? changes.length : 0;\n    if (changesCount === 0) {\n      return (\n        <div className=\"sdoc-file-history-header-right d-flex align-items-center\">\n          <div className=\"sdoc-file-changes-container d-flex align-items-center pl-2 pr-2\">\n            {gettext('No changes')}\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"sdoc-file-history-header-right d-flex align-items-center\">\n        <div className=\"sdoc-file-changes-container d-flex align-items-center\">\n          <div className=\"sdoc-file-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2\">\n            {`${gettext('Changes')} ${currentDiffIndex + 1}/${changesCount}`}\n          </div>\n          <div className=\"sdoc-file-changes-divider\"></div>\n          <div\n            className=\"sdoc-file-changes-last d-flex align-items-center justify-content-center\"\n            id=\"sdoc-file-changes-last\"\n            onClick={this.lastChange}\n          >\n            <span className=\"fas fa-chevron-up\"></span>\n          </div>\n          <div className=\"sdoc-file-changes-divider\"></div>\n          <div\n            className=\"sdoc-file-changes-next d-flex align-items-center justify-content-center\"\n            id=\"sdoc-file-changes-next\"\n            onClick={this.nextChange}\n          >\n            <span className=\"fas fa-chevron-down\"></span>\n          </div>\n          <UncontrolledTooltip placement=\"bottom\" target=\"sdoc-file-changes-last\">\n            {gettext('Last modification')}\n          </UncontrolledTooltip>\n          <UncontrolledTooltip placement=\"bottom\" target=\"sdoc-file-changes-next\">\n            {gettext('Next modification')}\n          </UncontrolledTooltip>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const { currentVersion, isShowChanges, currentVersionContent, lastVersionContent, isLoading } = this.state;\n\n    return (\n      <div className=\"sdoc-file-history d-flex h-100 w-100 o-hidden\">\n        <div className=\"sdoc-file-history-container d-flex flex-column\">\n          <div className=\"sdoc-file-history-header pt-2 pb-2 pl-4 pr-4 d-flex justify-content-between w-100 o-hidden\">\n            <div className={classnames('sdoc-file-history-header-left d-flex align-items-center o-hidden', { 'pr-4': isShowChanges })}>\n              <GoBack />\n              <div className=\"file-name text-truncate\">{fileName}</div>\n            </div>\n            {this.renderChangesTip()}\n          </div>\n          <div className=\"sdoc-file-history-content f-flex flex-column\" ref={ref => this.historyContentRef = ref}>\n            {isLoading ? (\n              <div className=\"sdoc-file-history-viewer d-flex align-items-center justify-content-center\">\n                <Loading />\n              </div>\n            ) : (\n              <DiffViewer\n                currentContent={currentVersionContent}\n                lastContent={isShowChanges ? lastVersionContent : ''}\n                didMountCallback={this.setDiffCount}\n              />\n            )}\n          </div>\n        </div>\n        <SidePanel\n          isShowChanges={isShowChanges}\n          currentVersion={currentVersion}\n          onSelectHistoryVersion={this.onSelectHistoryVersion}\n          onShowChanges={this.onShowChanges}\n        />\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SdocFileHistory />, document.getElementById('wrapper'));\n","import React, { Component } from 'react';\n\nimport './index.css';\n\nclass GoBack extends Component {\n\n  onBackClick = (event) => {\n    event.preventDefault();\n    window.history.back();\n  }\n\n  render() {\n    return (\n      <div className=\"go-back\" onClick={this.onBackClick}>\n        <span className=\"fas fa-chevron-left\"></span>\n      </div>\n    );\n  }\n}\n\nexport default GoBack;\n"],"sourceRoot":""}