{"version":3,"sources":["pages/sdoc-editor/external-operations.js","pages/sdoc-editor/index.js","view-file-sdoc.js","_i18n/i18n-sdoc-editor.js"],"names":["ExternalOperations","props","onInternalLinkToggle","setState","isShowInternalLinkDialog","state","unmark","repoID","docPath","seafileAPI","sdocUnmarkAsDraft","then","res","unmarkDraft","catch","error","errMessage","Utils","getErrorMsg","toaster","danger","toggleStar","isStarred","unstarItem","errorMsg","starItem","eventBus","EventBus","getInstance","this","unsubscribeInternalLinkEvent","subscribe","EXTERNAL_EVENT","INTERNAL_LINK_CLICK","unsubscribeStar","TOGGLE_STAR","unsubscribeUnmark","UNMARK_AS_DRAFT","path","onInternalLinkDialogToggle","React","Component","SdocEditor","isDraft","window","app","pageOptions","isSdocDraft","seafile","config","serviceURL","avatarURL","siteRoot","lang","userInfo","username","name","repoName","parentDir","filePerm","docName","docUuid","seadocAccessToken","seadocServerUrl","assetsUrl","isSdocRevision","isPublished","originFilename","revisionCreatedAt","isOpenSocket","serviceUrl","accessToken","sdocServer","docPerm","historyURL","generateHistoryURL","parentFolderURL","encodePath","isShowInternalLink","isStarIconShown","revisionURL","generateRevisionURL","ReactDom","render","i18n","fallback","document","getElementById","use","Backend","LanguageDetector","initReactI18next","init","lng","fallbackLng","ns","defaultNS","whitelist","backend","loadPath","mediaUrl","debug","interpolation","escapeValue","load","react","wait"],"mappings":"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","file":"static/js/viewFileSdoc.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { EventBus, EXTERNAL_EVENT } from '@seafile/sdoc-editor';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../../components/toast';\nimport InternalLinkDialog from '../../components/dialog/internal-link-dialog';\n\nconst propTypes = {\n  repoID: PropTypes.string.isRequired,\n  docPath: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  toggleStar: PropTypes.func.isRequired,\n  unmarkDraft: PropTypes.func.isRequired\n};\n\nclass ExternalOperations extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowInternalLinkDialog: false,\n    };\n  }\n\n  componentDidMount() {\n    const eventBus = EventBus.getInstance();\n    this.unsubscribeInternalLinkEvent = eventBus.subscribe(EXTERNAL_EVENT.INTERNAL_LINK_CLICK, this.onInternalLinkToggle);\n    this.unsubscribeStar = eventBus.subscribe(EXTERNAL_EVENT.TOGGLE_STAR, this.toggleStar);\n    this.unsubscribeUnmark = eventBus.subscribe(EXTERNAL_EVENT.UNMARK_AS_DRAFT, this.unmark);\n  }\n\n  componentWillUnmount() {\n    this.unsubscribeInternalLinkEvent();\n    this.unsubscribeStar();\n    this.unsubscribeUnmark();\n  }\n\n  onInternalLinkToggle = () => {\n    this.setState({isShowInternalLinkDialog: !this.state.isShowInternalLinkDialog});\n  }\n\n  unmark = () => {\n    const { repoID, docPath } = this.props;\n    seafileAPI.sdocUnmarkAsDraft(repoID, docPath).then((res) => {\n      this.props.unmarkDraft();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  toggleStar = () => {\n    const { isStarred, repoID, docPath  } = this.props;\n    if (isStarred) {\n      seafileAPI.unstarItem(repoID, docPath).then((res) => {\n        this.props.toggleStar(false);\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    } else {\n      seafileAPI.starItem(repoID, docPath).then((res) => {\n        this.props.toggleStar(true);\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    }\n  }\n\n  render() {\n    const { repoID, docPath } = this.props;\n    const { isShowInternalLinkDialog } = this.state;\n    return (\n      <>\n        {isShowInternalLinkDialog && (\n          <InternalLinkDialog\n            repoID={repoID}\n            path={docPath}\n            onInternalLinkDialogToggle={this.onInternalLinkToggle}\n          />\n        )}\n      </>\n    );\n  }\n}\n\nExternalOperations.propTypes = propTypes;\n\nexport default ExternalOperations;\n","import React, { Fragment } from 'react';\nimport { SimpleEditor } from '@seafile/sdoc-editor';\nimport ExternalOperations from './external-operations';\n\nexport default class SdocEditor extends React.Component {\n\n  constructor(props) {\n    super(props);\n    const { isStarred, isSdocDraft } = window.app.pageOptions;\n    this.state = {\n      isStarred: isStarred,\n      isDraft: isSdocDraft\n    };\n  }\n\n  toggleStar = (isStarred) => {\n    this.setState({isStarred: isStarred});\n  }\n\n  unmarkDraft = () => {\n    this.setState({isDraft: false});\n  }\n\n  render() {\n    const { repoID, docPath } = window.seafile;\n    const { isStarred, isDraft } = this.state;\n    return (\n      <Fragment>\n        <SimpleEditor isStarred={isStarred} isDraft={isDraft} />\n        <ExternalOperations\n          repoID={repoID}\n          docPath={docPath}\n          isStarred={isStarred}\n          toggleStar={this.toggleStar}\n          unmarkDraft={this.unmarkDraft}\n        />\n      </Fragment>\n    );\n  }\n}\n","import React, { Suspense } from 'react';\nimport ReactDom from 'react-dom';\nimport { I18nextProvider } from 'react-i18next';\nimport i18n from './_i18n/i18n-sdoc-editor';\nimport { Utils } from './utils/utils';\nimport Loading from './components/loading';\nimport SdocEditor from './pages/sdoc-editor';\n\nconst { serviceURL, avatarURL, siteRoot, lang } = window.app.config;\nconst { username, name } = window.app.userInfo;\nconst {\n  repoID, repoName, parentDir, filePerm,\n  docPath, docName, docUuid, seadocAccessToken, seadocServerUrl, assetsUrl,\n  isSdocRevision, isPublished, originFilename, revisionCreatedAt,\n} = window.app.pageOptions;\n\nwindow.seafile = {\n  repoID,\n  docPath,\n  docName,\n  docUuid,\n  isOpenSocket: true,\n  serviceUrl: serviceURL,\n  accessToken: seadocAccessToken,\n  sdocServer: seadocServerUrl,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  docPerm: filePerm,\n  historyURL: Utils.generateHistoryURL(siteRoot, repoID, docPath),\n  parentFolderURL: `${siteRoot}library/${repoID}/${Utils.encodePath(repoName + parentDir)}`,\n  assetsUrl,\n  isShowInternalLink: true,\n  isStarIconShown: true, // for star/unstar\n  isSdocRevision,\n  isPublished,\n  revisionURL: Utils.generateRevisionURL(siteRoot, repoID, docPath),\n  originFilename,\n  revisionCreatedAt,\n  lang,\n};\n\nReactDom.render(\n  <I18nextProvider i18n={ i18n } >\n    <Suspense fallback={<Loading />}>\n      <SdocEditor />\n    </Suspense>\n  </I18nextProvider>,\n  document.getElementById('wrapper')\n);\n","import i18n from 'i18next';\nimport Backend from 'i18next-xhr-backend';\nimport LanguageDetector from 'i18next-browser-languagedetector';\nimport { initReactI18next } from 'react-i18next';\nimport { mediaUrl } from '../utils/constants';\n\nconst lang = window.app.pageOptions.lang;\n\ni18n\n  .use(Backend)\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    lng: lang,\n    fallbackLng: 'en',\n    ns: ['sdoc-editor'],\n    defaultNS: 'sdoc-editor',\n\n    whitelist: ['en', 'zh-CN', 'fr', 'de', 'cs', 'es', 'es-AR', 'es-MX', 'ru'],\n\n    backend: {\n      loadPath: mediaUrl + 'sdoc-editor/locales/{{ lng }}/{{ ns }}.json',\n      // loadPath: '/media/locales/{{lng}}/{{ns}}.json',\n    },\n\n    debug: false, // console log if debug: true\n\n    interpolation: {\n      escapeValue: false, // not needed for react!!\n    },\n\n\n    load: 'currentOnly',\n\n    react: {\n      wait: true,\n    }\n  });\n\nexport default i18n;\n"],"sourceRoot":""}