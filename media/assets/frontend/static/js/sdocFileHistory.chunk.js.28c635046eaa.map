{"version":3,"sources":["../node_modules/@seafile/sdoc-editor/dist/pages/diff-viewer/history-version-viewer.js","../node_modules/@seafile/sdoc-editor/dist/basic-sdk/utils/object-utils.js","../node_modules/@seafile/sdoc-editor/dist/basic-sdk/utils/diff.js","../node_modules/@seafile/sdoc-editor/dist/pages/diff-viewer/diff-viewer.js","../node_modules/@seafile/sdoc-editor/dist/pages/diff-viewer/index.js","components/common/go-back/index.js","models/file-history.js","pages/sdoc-file-history/history-version.js","components/common/switch/index.js","pages/sdoc-file-history/side-panel.js","pages/sdoc-file-history/index.js"],"names":["HistoryVersionViewer","props","document","React","createElement","SDocViewer","generateDefaultDocContent","ObjectUtils","_classCallCheck","this","_createClass","key","value","data","type","Object","prototype","toString","call","replace","includes","getDataType","source","comparison","notIncludeKeys","_this","iterable","Error","concat","sourceKeys","keys","comparisonKeys","_objectSpread","filter","length","some","isObjectChanged","arguments","undefined","getElementIndexInDiffDocument","diffValue","element","findIndex","item","id","updateDiffValue","diff","oldElement","isSameObject","push","diff_type","DIFF_TYPE","COMMON","currentElementType","changes","DELETE","ADD","ELEMENT_TYPE","PARAGRAPH","HEADER1","HEADER2","HEADER3","HEADER4","HEADER5","HEADER6","BLOCKQUOTE","LINK","CHECK_LIST_ITEM","CODE_BLOCK","IMAGE","ORDERED_LIST","UNORDERED_LIST","LIST_ITEM","LIST_LIC","_diff$changes","_getElementDiffValue","getElementDiffValue","children","diffChanges","apply","_toConsumableArray","MODIFY","currentContent","oldContent","currentContentMap","oldContentMap","forEach","i","oldElementId","elementIndex","oldDocument","elementId","elementInDiffDocumentIdx","oldElementCount","elementInOldDocumentIndex","leftIndex","rightIndex","oldLeftElement","oldLastElement","getNearestElementIndex","splice","DiffViewer","_Component","_inherits","_super","_createSuper","_props","renderLeaf","editor","renderElement","attributes","className","lastContent","currentValue","oldValue","currentVersion","version","oldVersion","getDiff","withNodeId","context","initSettings","didMountCallback","Slate","onChange","Editable","readOnly","placeholder","onDOMBeforeInput","onKeyDown","Component","Index","_this$props","GoBack","onBackClick","event","preventDefault","window","history","back","onClick","moment","locale","app","config","lang","FileHistory","object","commitId","commit_id","ctime","format","creatorName","creator_name","size","revRenamedOldPath","rev_renamed_old_path","revFileId","rev_file_id","path","description","HistoryVersion","onMouseEnter","historyVersion","setState","isShowOperationIcon","onMouseLeave","onToggleClick","e","isMenuShow","state","onSelectHistoryVersion","onRestore","onItemDownload","isHighlightItem","url","URLDecorator","getUrl","filePath","objID","Dropdown","isOpen","toggle","DropdownToggle","tag","alt","gettext","DropdownMenu","index","DropdownItem","onItemRestore","href","onItemDownLoad","Switch","checked","disabled","classnames","name","SidePanel","init","hasMore","nextCommit","oldFilePath","listHistoryVersions","repoID","commit","callback","seafileAPI","listOldFileHistoryRecords","then","res","historyData","updateHistoryVersions","isLoading","errorMessage","catch","error","Utils","getErrorMsg","onScrollHandler","clientHeight","target","scrollHeight","scrollTop","loadMore","currentFilePath","historyRepoID","restoreVersion","editUtilities","revertFile","success","historyVersions","toaster","danger","isShowChanges","historyVersionIndex","renderHistoryVersions","map","onShowChanges","lastHistoryVersion","result","dataCount","next_start_commit","addedHistoryVersions","onScroll","serviceURL","avatarURL","siteRoot","pageOptions","username","fileHistory","fileName","docUuid","assetsUrl","seafile","docPath","docName","isOpenSocket","serviceUrl","SdocFileHistory","lastVersion","getFileRevision","getFileContent","currentVersionContent","lastVersionContent","setContent","currentDiffIndex","localStorage","setItem","setDiffCount","jumpToElement","change","changeElement","querySelectorAll","historyContentRef","offsetTop","lastChange","nextChange","getItem","changesCount","isShowChangesTips","UncontrolledTooltip","placement","ref","diffViewerRef","ReactDom","render","getElementById"],"mappings":"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","file":"static/js/sdocFileHistory.chunk.js","sourcesContent":["import React from 'react';\nimport { SDocViewer } from '../../basic-sdk';\nimport { generateDefaultDocContent } from '../../utils';\nfunction HistoryVersionViewer(props) {\n  var document = props.document;\n  return /*#__PURE__*/React.createElement(SDocViewer, {\n    document: document || generateDefaultDocContent()\n  });\n}\nexport default HistoryVersionViewer;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nvar ObjectUtils = /*#__PURE__*/function () {\n  function ObjectUtils() {\n    _classCallCheck(this, ObjectUtils);\n  }\n  _createClass(ObjectUtils, null, [{\n    key: \"getDataType\",\n    value: function getDataType(data) {\n      var type = typeof data;\n      if (type !== 'object') {\n        return type;\n      }\n      return Object.prototype.toString.call(data).replace(/^\\[object (\\S+)\\]$/, '$1');\n    }\n  }, {\n    key: \"iterable\",\n    value: function iterable(data) {\n      return ['Object', 'Array'].includes(this.getDataType(data));\n    }\n  }, {\n    key: \"isObjectChanged\",\n    value: function isObjectChanged(source, comparison, notIncludeKeys) {\n      var _this = this;\n      if (!this.iterable(source)) {\n        throw new Error(\"source should be a Object or Array , but got \".concat(this.getDataType(source)));\n      }\n      if (this.getDataType(source) !== this.getDataType(comparison)) {\n        return true;\n      }\n      var sourceKeys = Object.keys(source);\n      var comparisonKeys = Object.keys(_objectSpread(_objectSpread({}, source), comparison)).filter(function (key) {\n        return !notIncludeKeys.includes(key);\n      });\n      if (sourceKeys.length !== comparisonKeys.length) {\n        return true;\n      }\n      return comparisonKeys.some(function (key) {\n        if (_this.iterable(source[key])) {\n          return _this.isObjectChanged(source[key], comparison[key], notIncludeKeys);\n        } else {\n          return source[key] !== comparison[key];\n        }\n      });\n    }\n  }, {\n    key: \"isSameObject\",\n    value: function isSameObject(source, comparison) {\n      var notIncludeKeys = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      if (!source || !comparison) return false;\n      return !this.isObjectChanged(source, comparison, notIncludeKeys);\n    }\n  }]);\n  return ObjectUtils;\n}();\nexport default ObjectUtils;","import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { DIFF_TYPE, ELEMENT_TYPE } from '../../basic-sdk/extension/constants';\nimport ObjectUtils from './object-utils';\nvar getElementIndexInDiffDocument = function getElementIndexInDiffDocument(diffValue, element) {\n  return diffValue.findIndex(function (item) {\n    return item.id === element.id;\n  });\n};\nvar getNearestElementIndex = function getNearestElementIndex(diff, oldDocument, elementId) {\n  var diffValue = diff.value;\n  var elementInDiffDocumentIdx = getElementIndexInDiffDocument(diffValue, elementId);\n  if (elementInDiffDocumentIdx > -1) return elementInDiffDocumentIdx + 1;\n  var oldElementCount = oldDocument.length;\n  var elementInOldDocumentIndex = oldDocument.findIndex(function (item) {\n    return item.id === elementId;\n  });\n  var leftIndex = elementInOldDocumentIndex - 1;\n  leftIndex = leftIndex === -1 ? 0 : leftIndex;\n  var rightIndex = elementInOldDocumentIndex + 1;\n  rightIndex = rightIndex === oldElementCount - 1 ? oldElementCount - 1 : rightIndex;\n  while (elementInDiffDocumentIdx === -1 && leftIndex > -2 && rightIndex < oldElementCount + 1) {\n    if (leftIndex > -1) {\n      var oldLeftElement = oldDocument[leftIndex];\n      elementInDiffDocumentIdx = getElementIndexInDiffDocument(diffValue, oldLeftElement);\n      if (elementInDiffDocumentIdx > -1) {\n        return elementInDiffDocumentIdx + 1;\n      }\n    }\n    if (rightIndex < oldElementCount) {\n      var oldLastElement = oldDocument[rightIndex];\n      elementInDiffDocumentIdx = getElementIndexInDiffDocument(diffValue, oldLastElement);\n      if (elementInDiffDocumentIdx > -1) {\n        return elementInDiffDocumentIdx;\n      }\n    }\n    leftIndex--;\n    rightIndex++;\n    if (leftIndex === -2 && rightIndex < oldElementCount) {\n      leftIndex = -1;\n    }\n    if (rightIndex === oldElementCount && leftIndex > -1) {\n      rightIndex = oldElementCount;\n    }\n  }\n  return diffValue.length - 1;\n};\nvar updateDiffValue = function updateDiffValue(diff, element, oldElement) {\n  if (!diff || !element || !oldElement) return;\n  if (ObjectUtils.isSameObject(element, oldElement)) {\n    diff.value.push(_objectSpread(_objectSpread({}, element), {}, {\n      diff_type: DIFF_TYPE.COMMON\n    }));\n    return;\n  }\n  var currentElementType = element.type;\n  var oldElementType = oldElement.type;\n  if (currentElementType !== oldElementType) {\n    diff.changes.push(oldElement.id);\n    diff.value.push(_objectSpread(_objectSpread({}, oldElement), {}, {\n      diff_type: DIFF_TYPE.DELETE\n    }));\n    diff.value.push(_objectSpread(_objectSpread({}, element), {}, {\n      diff_type: DIFF_TYPE.ADD\n    }));\n    return;\n  }\n  switch (currentElementType) {\n    case ELEMENT_TYPE.PARAGRAPH:\n    case ELEMENT_TYPE.HEADER1:\n    case ELEMENT_TYPE.HEADER2:\n    case ELEMENT_TYPE.HEADER3:\n    case ELEMENT_TYPE.HEADER4:\n    case ELEMENT_TYPE.HEADER5:\n    case ELEMENT_TYPE.HEADER6:\n    case ELEMENT_TYPE.BLOCKQUOTE:\n    case ELEMENT_TYPE.LINK:\n    case ELEMENT_TYPE.CHECK_LIST_ITEM:\n    case ELEMENT_TYPE.CODE_BLOCK:\n    case ELEMENT_TYPE.IMAGE:\n      {\n        diff.changes.push(oldElement.id);\n        diff.value.push(_objectSpread(_objectSpread({}, oldElement), {}, {\n          diff_type: DIFF_TYPE.DELETE\n        }));\n        diff.value.push(_objectSpread(_objectSpread({}, element), {}, {\n          diff_type: DIFF_TYPE.ADD\n        }));\n        break;\n      }\n    case ELEMENT_TYPE.ORDERED_LIST:\n    case ELEMENT_TYPE.UNORDERED_LIST:\n    case ELEMENT_TYPE.LIST_ITEM:\n    case ELEMENT_TYPE.LIST_LIC:\n      {\n        var _diff$changes;\n        var _getElementDiffValue = getElementDiffValue(element.children, oldElement.children),\n          diffValue = _getElementDiffValue.value,\n          diffChanges = _getElementDiffValue.changes;\n        (_diff$changes = diff.changes).push.apply(_diff$changes, _toConsumableArray(diffChanges));\n        diff.value.push(_objectSpread(_objectSpread({}, element), {}, {\n          children: diffValue,\n          diff_type: DIFF_TYPE.MODIFY\n        }));\n        break;\n      }\n    default:\n      {\n        diff.changes.push(oldElement.id);\n        diff.value.push(_objectSpread(_objectSpread({}, oldElement), {}, {\n          diff_type: DIFF_TYPE.DELETE\n        }));\n        diff.value.push(_objectSpread(_objectSpread({}, element), {}, {\n          diff_type: DIFF_TYPE.ADD\n        }));\n        break;\n      }\n  }\n};\n\n/**\n * params:\n    * currentValue: current version document content\n    * oldValue: last version document content\n * return { value: [], change: [] }\n*/\nvar getElementDiffValue = function getElementDiffValue(currentContent, oldContent) {\n  // init\n  var diff = {\n    value: [],\n    changes: []\n  };\n  var currentContentMap = {};\n  var oldContentMap = {};\n  currentContent.forEach(function (element) {\n    currentContentMap[element.id] = element;\n  });\n  oldContent.forEach(function (element) {\n    oldContentMap[element.id] = element;\n  });\n\n  // generator diff elements\n  for (var i = 0; i < currentContent.length; i++) {\n    var element = currentContent[i];\n    var isAdded = !oldContentMap[element.id]; // added\n    if (isAdded) {\n      diff.changes.push(element.id);\n      diff.value.push(_objectSpread(_objectSpread({}, element), {}, {\n        diff_type: DIFF_TYPE.ADD\n      }));\n      continue;\n    }\n    updateDiffValue(diff, element, oldContentMap[element.id]);\n  }\n  oldContent.forEach(function (oldElement) {\n    var oldElementId = oldElement.id;\n    if (!currentContentMap[oldElementId]) {\n      // deleted\n      diff.changes.push(oldElementId);\n      var elementIndex = getNearestElementIndex(diff, oldContent, oldElementId);\n      diff.value.splice(elementIndex, 0, _objectSpread(_objectSpread({}, oldElement), {}, {\n        diff_type: DIFF_TYPE.DELETE\n      }));\n    }\n  });\n  return diff;\n};\n\n/**\n * params:\n    * currentValue: current version document\n    * oldValue: last version document\n * return { value: [], change: [] }\n*/\nexport var getDiff = function getDiff() {\n  var currentValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n    children: []\n  };\n  var oldValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    children: []\n  };\n  var currentVersion = currentValue.version,\n    currentContent = currentValue.children;\n  var oldVersion = oldValue.version,\n    oldContent = oldValue.children;\n  if (currentVersion === oldVersion) return {\n    value: currentContent,\n    changes: []\n  };\n  return getElementDiffValue(currentContent, oldContent);\n};","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/esm/createSuper\";\nimport React, { Component } from 'react';\nimport { Editable, Slate } from '@seafile/slate-react';\nimport editor, { renderLeaf, renderElement } from '../../basic-sdk/extension';\nimport withNodeId from '../../basic-sdk/node-id';\nimport { getDiff } from '../../basic-sdk/utils/diff';\nimport { DIFF_TYPE, ELEMENT_TYPE } from '../../basic-sdk/extension/constants';\nimport context from '../../context';\nimport '../../assets/css/diff-viewer.css';\nvar DiffViewer = /*#__PURE__*/function (_Component) {\n  _inherits(DiffViewer, _Component);\n  var _super = _createSuper(DiffViewer);\n  function DiffViewer(_props) {\n    var _this;\n    _classCallCheck(this, DiffViewer);\n    _this = _super.call(this, _props);\n    _this.renderLeaf = function (props) {\n      return renderLeaf(props, _this.editor);\n    };\n    _this.renderElement = function (props) {\n      var element = props.element;\n      var diff_type = element.diff_type,\n        type = element.type;\n      if (diff_type === DIFF_TYPE.ADD) {\n        if (type === ELEMENT_TYPE.LIST_ITEM) {\n          return renderElement(_objectSpread(_objectSpread({}, props), {}, {\n            attributes: _objectSpread(_objectSpread({}, props.attributes), {}, {\n              className: 'sdoc-diff-added'\n            })\n          }), _this.editor);\n        }\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"sdoc-diff sdoc-diff-added\"\n        }, renderElement(_objectSpread(_objectSpread({}, props), {}, {\n          attributes: _objectSpread(_objectSpread({}, props.attributes), {}, {\n            className: 'sdoc-diff-added'\n          })\n        }), _this.editor));\n      }\n      if (diff_type === DIFF_TYPE.DELETE) {\n        if (type === ELEMENT_TYPE.LIST_ITEM) {\n          return renderElement(_objectSpread(_objectSpread({}, props), {}, {\n            attributes: _objectSpread(_objectSpread({}, props.attributes), {}, {\n              className: 'sdoc-diff-removed'\n            })\n          }), _this.editor);\n        }\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"sdoc-diff sdoc-diff-removed\"\n        }, renderElement(_objectSpread(_objectSpread({}, props), {}, {\n          attributes: _objectSpread(_objectSpread({}, props.attributes), {}, {\n            className: 'sdoc-diff-removed'\n          })\n        }), _this.editor));\n      }\n      if (diff_type === DIFF_TYPE.MODIFY) {\n        if (type === ELEMENT_TYPE.ORDERED_LIST || type === ELEMENT_TYPE.UNORDERED_LIST) {\n          return renderElement(_objectSpread(_objectSpread({}, props), {}, {\n            attributes: _objectSpread(_objectSpread({}, props.attributes), {}, {\n              className: 'sdoc-diff-modify'\n            })\n          }), _this.editor);\n        }\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"sdoc-diff-modify\"\n        }, renderElement(_objectSpread(_objectSpread({}, props), {}, {\n          attributes: _objectSpread(_objectSpread({}, props.attributes), {}, {\n            className: 'sdoc-diff-modify'\n          })\n        }), _this.editor));\n      }\n      return renderElement(props, _this.editor);\n    };\n    var currentContent = _props.currentContent,\n      lastContent = _props.lastContent;\n    _this.diff = currentContent ? getDiff(currentContent, lastContent) : {\n      value: [],\n      changes: []\n    };\n    _this.editor = withNodeId(editor);\n    context.initSettings();\n    return _this;\n  }\n  _createClass(DiffViewer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.didMountCallback && this.props.didMountCallback(this.diff);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"sdoc-editor-container\"\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"sdoc-editor-content\"\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"flex-fill o-auto\"\n      }, /*#__PURE__*/React.createElement(Slate, {\n        editor: this.editor,\n        value: this.diff.value,\n        onChange: function onChange() {}\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"article mx-auto\"\n      }, /*#__PURE__*/React.createElement(Editable, {\n        readOnly: true,\n        placeholder: \"\",\n        renderElement: this.renderElement,\n        renderLeaf: this.renderLeaf,\n        onDOMBeforeInput: function onDOMBeforeInput() {},\n        onKeyDown: function onKeyDown() {}\n      }))))));\n    }\n  }]);\n  return DiffViewer;\n}(Component);\nexport default DiffViewer;","import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/esm/createSuper\";\nimport React, { Component } from 'react';\nimport HistoryVersionViewer from './history-version-viewer';\nimport DiffViewer from './diff-viewer';\nimport context from '../../context';\nvar Index = /*#__PURE__*/function (_Component) {\n  _inherits(Index, _Component);\n  var _super = _createSuper(Index);\n  function Index(props) {\n    var _this;\n    _classCallCheck(this, Index);\n    _this = _super.call(this, props);\n    context.initSettings();\n    return _this;\n  }\n  _createClass(Index, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n        currentContent = _this$props.currentContent,\n        lastContent = _this$props.lastContent;\n      if (!lastContent) {\n        return /*#__PURE__*/React.createElement(HistoryVersionViewer, {\n          document: currentContent\n        });\n      }\n      return /*#__PURE__*/React.createElement(DiffViewer, this.props);\n    }\n  }]);\n  return Index;\n}(Component);\nexport default Index;","import React, { Component } from 'react';\n\nimport './index.css';\n\nclass GoBack extends Component {\n\n  onBackClick = (event) => {\n    event.preventDefault();\n    window.history.back();\n  }\n\n  render() {\n    return (\n      <div className=\"go-back\" onClick={this.onBackClick}>\n        <span className=\"fas fa-chevron-left\"></span>\n      </div>\n    );\n  }\n}\n\nexport default GoBack;\n","import moment from 'moment';\nmoment.locale(window.app.config.lang);\n\nexport default class FileHistory {\n\n  constructor(object) {\n    this.commitId = object.commit_id || undefined;\n    this.ctime = object.ctime ? moment(object.ctime).format('YYYY-MM-DD HH:mm') : '';\n    this.creatorName = object.creator_name || '';\n    this.size = object.size || 0;\n    this.revRenamedOldPath = object.rev_renamed_old_path || '';\n    this.revFileId = object.rev_file_id || '';\n    this.path = object.path || '';\n    this.description = object.description || '';\n  }\n\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport { gettext, filePath } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\n\nimport '../../css/history-record-item.css';\n\nclass HistoryVersion extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowOperationIcon: false,\n      isMenuShow: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commitId === historyVersion.commitId) return;\n    this.setState({ isShowOperationIcon: true });\n  }\n\n  onMouseLeave = () => {\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commitId === historyVersion.commitId) return;\n    this.setState({ isShowOperationIcon: false });\n  }\n\n  onToggleClick = (e) => {\n    this.setState({ isMenuShow: !this.state.isMenuShow });\n  }\n\n  onClick = () => {\n    this.setState({ isShowOperationIcon: false });\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commitId === historyVersion.commitId) return;\n    this.props.onSelectHistoryVersion(historyVersion);\n  }\n\n  onRestore = () => {\n    const { historyVersion } = this.props;\n    this.props.onRestore(historyVersion);\n  }\n\n  onItemDownload = () => {\n    // nothing todo\n  }\n\n  render() {\n    const { currentVersion, historyVersion } = this.props;\n    if (!currentVersion || !historyVersion) return null;\n    const { ctime, commitId, creatorName, revFileId } = historyVersion;\n    const isHighlightItem = commitId === currentVersion.commitId;\n    const url = URLDecorator.getUrl({ type: 'download_historic_file', filePath: filePath, objID: revFileId });\n    return (\n      <li\n        className={`history-list-item ${isHighlightItem ? 'item-active' : ''}`}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        onClick={this.onClick}\n      >\n        <div className=\"history-info\">\n          <div className=\"time\">{ctime}</div>\n          <div className=\"owner\">\n            <span className=\"squire-icon\"></span>\n            <span>{creatorName}</span>\n          </div>\n        </div>\n        <div className=\"history-operation\">\n          <Dropdown isOpen={this.state.isMenuShow} toggle={this.onToggleClick}>\n            <DropdownToggle\n              tag='a'\n              className={`fas fa-ellipsis-v ${(this.state.isShowOperationIcon || isHighlightItem) ? '' : 'invisible'}`}\n              data-toggle=\"dropdown\"\n              aria-expanded={this.state.isMenuShow}\n              alt={gettext('More Operations')}\n            />\n            <DropdownMenu>\n              {(this.props.index !== 0) && <DropdownItem onClick={this.onItemRestore}>{gettext('Restore')}</DropdownItem>}\n              <DropdownItem tag='a' href={url} onClick={this.onItemDownLoad}>{gettext('Download')}</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </div>\n      </li>\n    );\n  }\n}\n\nHistoryVersion.propTypes = {\n  index: PropTypes.number,\n  currentVersion: PropTypes.object.isRequired,\n  historyVersion: PropTypes.object,\n  onSelectHistoryVersion: PropTypes.func.isRequired,\n  onRestore: PropTypes.func.isRequired,\n};\n\nexport default HistoryVersion;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\n\nimport '../../../css/switch.css';\n\nfunction Switch(props) {\n  const { onChange, checked, placeholder, disabled, className, size } = props;\n\n  return(\n    <div className={classnames('seahub-switch position-relative', className, size)}>\n      <label className=\"custom-switch\">\n        <input\n          className=\"custom-switch-input\"\n          type=\"checkbox\"\n          checked={checked}\n          onChange={onChange}\n          name=\"custom-switch-checkbox\"\n          disabled={disabled}\n        />\n        <span className=\"custom-switch-description text-truncate\">{placeholder}</span>\n        <span className=\"custom-switch-indicator\"></span>\n      </label>\n    </div>\n  );\n}\n\nSwitch.propTypes = {\n  checked: PropTypes.bool,\n  disabled: PropTypes.bool,\n  placeholder: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n  className: PropTypes.string,\n  size: PropTypes.oneOf(['large', 'small', undefined]),\n  onChange: PropTypes.func.isRequired,\n};\n\nexport default Switch;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport Loading from '../../components/loading';\nimport { gettext, filePath, historyRepoID } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport FileHistory from '../../models/file-history';\nimport { Utils } from '../../utils/utils';\nimport editUtilities from '../../utils/editor-utilities';\nimport toaster from '../../components/toast';\nimport HistoryVersion from './history-version';\nimport Switch from '../../components/common/switch';\n\nclass SidePanel extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      historyVersions: [],\n      errorMessage: '',\n    };\n    this.init();\n  }\n\n  componentDidMount() {\n    this.listHistoryVersions(historyRepoID, filePath, this.nextCommit, (historyVersion, lastHistoryVersion) => {\n      this.props.onSelectHistoryVersion(historyVersion, lastHistoryVersion);\n    });\n  }\n\n  init = () => {\n    this.hasMore = true;\n    this.nextCommit = '';\n    this.filePath = '';\n    this.oldFilePath = '';\n  }\n\n  listHistoryVersions = (repoID, filePath, commit, callback) => {\n    seafileAPI.listOldFileHistoryRecords(repoID, filePath, commit).then((res) => {\n      let historyData = res.data;\n      if (!historyData) {\n        this.setState({ isLoading: false, errorMessage: 'There is an error in server.' });\n        return;\n      }\n      this.updateHistoryVersions(historyData, callback);\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      this.setState({ isLoading: false, errorMessage: errorMessage });\n    });\n  }\n\n  updateHistoryVersions(result, callback) {\n    const dataCount = result.data ? result.data.length : 0;\n    this.nextCommit = result.next_start_commit || '';\n    if (dataCount) {\n      const addedHistoryVersions = result.data.map(item => new FileHistory(item));\n      this.filePath = addedHistoryVersions[dataCount - 1].path;\n      this.oldFilePath = addedHistoryVersions[dataCount - 1].revRenamedOldPath;\n      const historyVersions = [ ...this.state.historyVersions, ...addedHistoryVersions ];\n      this.setState({ historyVersions: historyVersions, isLoading: false, errorMessage: '' }, () => {\n        callback && callback(historyVersions[0], historyVersions[1]);\n      });\n      return;\n    }\n    if (this.nextCommit) {\n      this.listHistoryVersions(historyRepoID, filePath, this.nextCommit);\n      return;\n    }\n    this.hasMore = false;\n    this.setState({ isLoading: false, errorMessage: '' });\n  }\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    if (isBottom && this.hasMore && this.nextCommit) {\n      this.loadMore();\n    }\n  }\n\n  loadMore = () => {\n    if (this.state.isLoading) return;\n    this.setState({ isLoading: true }, () => {\n      const currentFilePath = this.oldFilePath || this.filePath;\n      this.listHistoryVersions(historyRepoID, currentFilePath, this.nextCommit);\n    });\n  }\n\n  restoreVersion = (historyVersion) => {\n    const { commitId, path } = historyVersion;\n    editUtilities.revertFile(path, commitId).then(res => {\n      if (res.data.success) {\n        this.init();\n        this.setState({ isLoading: true, historyVersions: [], errorMessage: '' } , () => {\n          this.listHistoryVersions(historyRepoID, filePath);\n        });\n      }\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n    });\n  }\n\n  onSelectHistoryVersion = (historyVersion) => {\n    const { isShowChanges } = this.props;\n    if (!isShowChanges) {\n      this.props.onSelectHistoryVersion(historyVersion);\n      return;\n    }\n    const { historyVersions } = this.state;\n    const historyVersionIndex = historyVersions.findIndex(item => item.commitId === historyVersion.commitId);\n    this.props.onSelectHistoryVersion(historyVersion, historyVersions[historyVersionIndex + 1]);\n  }\n\n  renderHistoryVersions = () => {\n    const { isLoading, historyVersions, errorMessage } = this.state;\n    if (historyVersions.length === 0) {\n      if (isLoading) {\n        return (\n          <div className=\"h-100 w-100 d-flex align-items-center justify-content-center\">\n            <Loading />\n          </div>\n        );\n      }\n      if (errorMessage) {\n        return (\n          <div className=\"h-100 w-100 d-flex align-items-center justify-content-center error-message\">\n            {gettext(errorMessage)}\n          </div>\n        );\n      }\n      return (\n        <div className=\"h-100 w-100 d-flex align-items-center justify-content-center empty-tip-color\">\n          {gettext('No_historical_versions')}\n        </div>\n      );\n    }\n\n    return (\n      <>\n        {historyVersions.map((historyVersion, index) => {\n          return (\n            <HistoryVersion\n              key={historyVersion.commitId}\n              index={index}\n              currentVersion={this.props.currentVersion}\n              historyVersion={historyVersion}\n              onSelectHistoryVersion={this.onSelectHistoryVersion}\n              onRestore={this.restoreVersion}\n            />\n          );\n        })}\n        {isLoading && (\n          <div className=\"loading-more d-flex align-items-center justify-content-center w-100\">\n            <Loading />\n          </div>\n        )}\n      </>\n    );\n  }\n\n  onShowChanges = () => {\n    const { isShowChanges } = this.props;\n    this.props.onShowChanges(!isShowChanges);\n  }\n\n  render() {\n    const { historyVersions } = this.state;\n\n    return (\n      <div className=\"sdoc-file-history-panel h-100 o-hidden d-flex flex-column\">\n        <div className=\"sdoc-file-history-select-range\">\n          <div className=\"sdoc-file-history-select-range-title\">\n            {gettext('History Versions')}\n          </div>\n        </div>\n        <div\n          className={classnames('sdoc-file-history-versions', { 'o-hidden': historyVersions.length === 0 } )}\n          onScroll={this.onScrollHandler}\n        >\n          {this.renderHistoryVersions()}\n        </div>\n        <div className=\"sdoc-file-history-diff-switch d-flex align-items-center\">\n          <Switch\n            checked={this.props.isShowChanges}\n            placeholder={gettext('Show changes')}\n            className=\"sdoc-history-show-changes w-100\"\n            size=\"small\"\n            onChange={this.onShowChanges}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = {\n  isShowChanges: PropTypes.bool,\n  currentVersion: PropTypes.object,\n  onSelectHistoryVersion: PropTypes.func,\n  onShowChanges: PropTypes.func,\n};\n\nexport default SidePanel;\n","import React from 'react';\nimport ReactDom from 'react-dom';\nimport { UncontrolledTooltip } from 'reactstrap';\nimport classnames from 'classnames';\nimport DiffViewer from '@seafile/sdoc-editor/dist/pages/diff-viewer';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext, historyRepoID } from '../../utils/constants';\nimport Loading from '../../components/loading';\nimport GoBack from '../../components/common/go-back';\nimport SidePanel from './side-panel';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../../components/toast';\n\nimport '../../css/layout.css';\nimport '../../css/sdoc-file-history.css';\n\nconst { serviceURL, avatarURL, siteRoot } = window.app.config;\nconst { username, name } = window.app.pageOptions;\nconst { repoID, fileName, filePath, docUuid, assetsUrl  } = window.fileHistory.pageOptions;\n\nwindow.seafile = {\n  repoID,\n  docPath: filePath,\n  docName: fileName,\n  docUuid,\n  isOpenSocket: false,\n  serviceUrl: serviceURL,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  assetsUrl,\n};\n\nclass SdocFileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    const isShowChanges = localStorage.getItem('seahub-sdoc-history-show-changes') === 'false' ? false : true;\n    this.state = {\n      isLoading: true,\n      isShowChanges,\n      currentVersion: {},\n      currentVersionContent: '',\n      lastVersionContent: '',\n      changes: [],\n      currentDiffIndex: 0,\n    };\n  }\n\n  onSelectHistoryVersion = (currentVersion, lastVersion) => {\n    this.setState({ isLoading: true, currentVersion });\n    seafileAPI.getFileRevision(historyRepoID, currentVersion.commitId, currentVersion.path).then(res => {\n      return seafileAPI.getFileContent(res.data);\n    }).then(res => {\n      const currentVersionContent = res.data;\n      if (lastVersion) {\n        seafileAPI.getFileRevision(historyRepoID, lastVersion.commitId, lastVersion.path).then(res => {\n          return seafileAPI.getFileContent(res.data);\n        }).then(res => {\n          const lastVersionContent = res.data;\n          this.setContent(currentVersionContent, lastVersionContent);\n        }).catch(error => {\n          const errorMessage = Utils.getErrorMsg(error, true);\n          toaster.danger(gettext(errorMessage));\n          this.setContent(currentVersionContent, '');\n        });\n      } else {\n        this.setContent(currentVersionContent, '');\n      }\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n      this.setContent('', '');\n    });\n  }\n\n  setContent = (currentVersionContent = '', lastVersionContent = '') => {\n    this.setState({ currentVersionContent, lastVersionContent, isLoading: false, changes: [], currentDiffIndex: 0 });\n  }\n\n  onShowChanges = (isShowChanges) => {\n    this.setState({ isShowChanges }, () => {\n      localStorage.setItem('seahub-sdoc-history-show-changes', isShowChanges + '');\n    });\n  }\n\n  setDiffCount = (diff = { value: [], changes: [] }) => {\n    const { changes } = diff;\n    this.setState({ changes, currentDiffIndex: 0 });\n  }\n\n  jumpToElement = (currentDiffIndex) => {\n    this.setState({ currentDiffIndex }, () => {\n      const { currentDiffIndex, changes } = this.state;\n      const change = changes[currentDiffIndex];\n      const changeElement = document.querySelectorAll(`[data-id=${change}]`)[0];\n      if (changeElement) {\n        this.historyContentRef.scrollTop = changeElement.offsetTop - 10;\n      }\n    });\n  }\n\n  lastChange = () => {\n    const { currentDiffIndex, changes } = this.state;\n    if (currentDiffIndex === 0) {\n      this.jumpToElement(changes.length - 1);\n      return;\n    }\n    this.jumpToElement(currentDiffIndex - 1);\n  }\n\n  nextChange = () => {\n    const { currentDiffIndex, changes } = this.state;\n    if (currentDiffIndex === changes.length - 1) {\n      this.jumpToElement(0);\n      return;\n    }\n    this.jumpToElement(currentDiffIndex + 1);\n  }\n\n  render() {\n    const { currentVersion, isShowChanges, currentVersionContent, lastVersionContent, isLoading, changes, currentDiffIndex } = this.state;\n    const changesCount = changes ? changes.length : 0;\n    const isShowChangesTips = isShowChanges && changesCount > 0;\n\n    return (\n      <div className=\"sdoc-file-history d-flex h-100 w-100 o-hidden\">\n        <div className=\"sdoc-file-history-container d-flex flex-column\">\n          <div className=\"sdoc-file-history-header pt-2 pb-2 pl-4 pr-4 d-flex justify-content-between w-100 o-hidden\">\n            <div className={classnames('sdoc-file-history-header-left d-flex align-items-center o-hidden', { 'pr-4': isShowChangesTips })}>\n              <GoBack />\n              <div className=\"file-name text-truncate\">{fileName}</div>\n            </div>\n            {isShowChangesTips && (\n              <div className=\"sdoc-file-history-header-right d-flex align-items-center\">\n                <div className=\"sdoc-file-changes-container d-flex align-items-center \">\n                  <div className=\"sdoc-file-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2\">\n                    {`${gettext('Changes')} ${currentDiffIndex + 1}/${changesCount}`}\n                  </div>\n                  <div className=\"sdoc-file-changes-divider\"></div>\n                  <div\n                    className=\"sdoc-file-changes-last d-flex align-items-center justify-content-center\"\n                    id=\"sdoc-file-changes-last\"\n                    onClick={this.lastChange}\n                  >\n                    <span className=\"fas fa-chevron-up\"></span>\n                  </div>\n                  <div className=\"sdoc-file-changes-divider\"></div>\n                  <div\n                    className=\"sdoc-file-changes-next d-flex align-items-center justify-content-center\"\n                    id=\"sdoc-file-changes-next\"\n                    onClick={this.nextChange}\n                  >\n                    <span className=\"fas fa-chevron-down\"></span>\n                  </div>\n                  <UncontrolledTooltip placement=\"bottom\" target=\"sdoc-file-changes-last\">\n                    {gettext('Last modification')}\n                  </UncontrolledTooltip>\n                  <UncontrolledTooltip placement=\"bottom\" target=\"sdoc-file-changes-next\">\n                    {gettext('Next modification')}\n                  </UncontrolledTooltip>\n                </div>\n              </div>\n            )}\n          </div>\n          <div className=\"sdoc-file-history-content f-flex flex-column\" ref={ref => this.historyContentRef = ref}>\n            {isLoading ? (\n              <div className=\"sdoc-file-history-viewer d-flex align-items-center justify-content-center\">\n                <Loading />\n              </div>\n            ) : (\n              <DiffViewer\n                ref={ref => this.diffViewerRef = ref}\n                currentContent={currentVersionContent}\n                lastContent={isShowChanges ? lastVersionContent : ''}\n                didMountCallback={this.setDiffCount}\n              />\n            )}\n          </div>\n        </div>\n        <SidePanel\n          isShowChanges={isShowChanges}\n          currentVersion={currentVersion}\n          onSelectHistoryVersion={this.onSelectHistoryVersion}\n          onShowChanges={this.onShowChanges}\n        />\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SdocFileHistory />, document.getElementById('wrapper'));\n"],"sourceRoot":""}